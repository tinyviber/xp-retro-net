
### **产品需求文档 (PRD): 网络故障排查模拟器**

*   **文档版本:** 1.0
*   **创建日期:** 2025年10月22日
*   **作者:** Gemini
*   **状态:** 初稿

---

### 1. 产品概述 (Product Overview)

“网络故障排查模拟器”是一个基于 Web 的交互式教学工具，旨在帮助网络初学者在
一个安全、可控的虚拟环境中，通过动手实践来理解和掌握基础的网络故障排查方法。

应用将以一系列预设的故障场景（练习题）呈现，学生需要通过模拟的命令行工具和网络配置界面来“诊断”和“修复”问题，并记录其操作过程与分析。

### 2. 产品目标 (Product Goals)

*   **提升教学效果:** 将理论知识（IP 地址、子网掩码、网关、DNS）与实践操作相结合，加深学生理解。
*   **提供安全实践环境:** 学生可以在不影响真实网络环境的情况下，自由进行网络配置的修改和测试。
*   **巩固排查技能:** 引导学生学习使用 `ipconfig`, `ping`, `nslookup` 等基础命令进行系统化的故障排查。
*   **降低教学门槛:** 无需复杂的虚拟机或物理设备，有浏览器的设备即可进行实验。

### 3. 目标用户 (Target Audience)

*   **主要用户:** 正在学习计算机网络基础知识的学生、IT 培训生。
*   **次要用户:** 负责网络教学的教师或培训师，可将此工具用作课堂演示或课后作业。

---

### 4. 功能需求 (Functional Requirements)

| ID | 需求名称 | 优先级 | 需求描述 |
| :--- | :--- | :--- | :--- |
| **FR-1** | **练习选择模块** | **高** | - 系统主界面提供至少三个练习题的入口，允许用户自由切换。<br>- 切换练习题时，虚拟环境的状态应完全重置为该练习的初始设定。 |
| **FR-2** | **练习内容展示** | **高** | - **问题描述区:** 清晰展示当前练习的背景、任务和提示信息。<br>- **虚拟操作环境:** 提供一个模拟的桌面或操作区域，包含“网络配置”入口和“虚拟终端”。<br>- **文档记录区:** 提供一个文本输入区域，供学生记录操作步骤、命令结果和分析。该区域内容应在练习切换时不保存。 |
| **FR-3** | **虚拟网络配置** | **高** | - 点击“网络”图标时，应弹出一个模拟“网络连接属性”的窗口（复用 `NetworkConfig` 组件）。<br>- 窗口应预填充当前练习场景的初始网络配置（如错误的 IP、空网关等）。<br>- 学生可以在此窗口中修改 IP 地址、子网掩码、默认网关和 DNS 服务器地址。<br>- 点击“确定”按钮后，所做的修改将更新虚拟环境的当前状态，并关闭窗口。点击“取消”则不保存更改并关闭窗口。 |
| **FR-4** | **虚拟终端** | **高** | - 提供一个模拟命令行的界面，包含输入提示符和历史输出区域。<br>- 支持以下命令的虚拟执行：`ipconfig`, `ping <ip/domain>`, `nslookup <domain>`。<br>- 命令的输出结果**必须**根据当前虚拟网络配置状态动态生成。<br>- 输入无法识别的命令时，返回标准错误提示（如 `不是内部或外部命令...`）。 |
| **FR-5** | **文档记录面板** | **中** | - 提供一个简单的文本区域 (`<textarea>`)，允许学生输入和编辑多行文本。<br>- (可选) 提供一个“复制内容”按钮，方便学生将答案导出。 |
| **FR-6** | **状态管理** | **高** | - 每个练习场景的网络配置状态应独立管理。<br>- 用户的操作（如修改网络配置）仅影响当前练习的状态，不影响其他练习。<br>- 刷新页面或切换练习后，当前练习恢复到其初始故障状态。 |

---

### 5. 用户流程 (User Flow)

1.  **进入应用:** 用户打开 Web App，看到主界面，默认加载练习 1。
2.  **选择练习:** 用户可以通过顶部的标签或按钮切换到“练习 2”。
3.  **阅读问题:** 用户在左侧的“问题描述区”阅读练习 2 的背景（无法访问互联网，网关为空）。
4.  **初步诊断:** 用户打开“虚拟终端”，输入 `ipconfig`，看到网关为空的输出。接着尝试 `ping 8.8.8.8`，终端返回“网络无法访问”或“请求超时”的模拟结果。
5.  **解决问题:**
    *   用户点击桌面上的“网络”图标，打开“网络连接属性”窗口。
    *   在窗口中，用户根据任务提示，将默认网关地址填写为 `192.168.1.1`。
    *   用户点击“确定”按钮，窗口关闭，虚拟网络配置状态被更新。
6.  **验证结果:**
    *   用户再次在虚拟终端中输入 `ping 8.8.8.8`，此时终端返回一个成功的 Ping 结果。
    *   用户接着输入 `ping baidu.com`，由于 DNS 是正确的，终端也返回成功结果。
7.  **记录文档:** 用户在“文档记录区”写下自己的操作步骤：“1. 使用 `ipconfig` 发现网关为空... 2. 打开网络配置，填入网关 `192.168.1.1`... 3. 再次 `ping` 公网 IP 成功...”。
8.  **完成练习:** 用户切换到下一个练习，当前练习的所有状态（包括网络配置和文档）重置。

---

### 6. 页面与组件设计 (Pages & Component Design)

#### **6.1. 主应用布局 (`ExerciseView.tsx`)**

*   **布局:** 采用三栏式或灵活布局。
    *   左侧：`ProblemDescription` 组件，展示静态文本。
    *   中间：`VirtualEnvironment` 组件，包含交互元素。
    *   右侧/下方：`DocumentationPanel` 组件。
*   **状态管理:**
    *   `networkConfig: NetworkSettings` - 核心状态，存储当前虚拟网络的配置。
    *   `isNetworkConfigOpen: boolean` - 控制配置窗口的显示/隐藏。
    *   `terminalHistory: string[]` - 存储终端的输入和输出历史。

#### **6.2. 网络配置窗口 (`NetworkConfig.tsx`)**

*   **Props:**
    *   `initialSettings: NetworkSettings` - 用于初始化窗口中的表单字段。
    *   `onApply: (newSettings: NetworkSettings) => void` - 点击“确定”时触发的回调，将修改后的配置传回父组件。
    *   `onClose: () => void` - 点击“取消”或关闭按钮时触发的回调。
*   **UI:** 保持现有 Windows XP 风格，确保所有输入框和单选按钮功能正常。

#### **6.3. 虚拟终端 (`VirtualTerminal.tsx`)**

*   **UI:**
    *   一个只读区域，用于渲染 `terminalHistory` 数组中的内容。
    *   一个带有 `C:\>` 提示符的输入框。
*   **逻辑:**
    *   监听输入框的回车事件。
    *   事件触发时，调用 `executeVirtualCommand(command, currentNetworkConfig)` 函数。
    *   将用户输入的命令和函数返回的输出追加到 `terminalHistory` 中。
    *   清空输入框。

---

### 7. 核心逻辑：虚拟命令处理器

**函数签名:** `executeVirtualCommand(command: string, config: NetworkSettings): string`

| 命令 | 输入示例 | 判断逻辑 | 成功输出 (示例) | 失败输出 (示例) |
| :--- | :--- | :--- | :--- | :--- |
| `ipconfig` | `ipconfig` | 无 | 返回一个格式化的字符串，包含 `config` 对象中的所有当前值。 | N/A |
| `ping <ip>` | `ping 8.8.8.8` | 1. 检查 `config.gateway` 是否为有效值 (e.g., `192.168.1.1`)。 | `正在 Ping 8.8.8.8... 来自 8.8.8.8 的回复...` | `请求超时。` 或 `Ping 请求找不到主机...` |
| | `ping 192.168.1.5` | 1. 检查 `config.ipAddress` 是否与目标 IP 在同一网段 (e.g., 都以 `192.168.1.` 开头)。 | `正在 Ping 192.168.1.5... 来自 192.168.1.5 的回复...` | `请求超时。` |
| `ping <domain>`| `ping baidu.com` | 1. 检查 `config.gateway` 是否有效。<br>2. 检查 `config.dns` 是否为公共 DNS (e.g., `8.8.8.8`, `1.1.1.1`)。 | `正在 Ping baidu.com [x.x.x.x]... 来自 x.x.x.x 的回复...` | `Ping 请求找不到主机 baidu.com...` |
| `nslookup <domain>`| `nslookup example.com`| 1. 检查 `config.dns` 是否为公共 DNS。 | `服务器: google-public-dns-a.google.com... 名称: example.com...` | `服务器: UnKnown... Address: 123.123.123.123... *** UnKnown 找不到 example.com` |

---

### 8. 数据模型 (Data Model)

**`NetworkSettings` 接口**

```typescript
export interface NetworkSettings {
  ipAddress: string;
  subnetMask: string;
  gateway: string;
  dns: string;
}
```

**`Exercise` 初始状态数据结构**

```typescript
// 用于存储每个练习的初始故障状态
export const initialExerciseStates: Record<number, NetworkSettings> = {
  1: { /* APIPA 地址配置 */ },
  2: { /* 缺失网关配置 */ },
  3: { /* 错误 DNS 配置 */ }
};
```

### 9. 非功能性需求 (Non-Functional Requirements)

*   **浏览器兼容性:** 应用应在最新版本的 Chrome, Firefox, Safari 和 Edge 浏览器上正常运行。
*   **响应式设计:** 界面在桌面和平板设备上应有良好的可用性。移动端为次要考虑。
*   **性能:** 应用应轻量且响应迅速，所有交互应无明显延迟。

### 10. 未来展望 (Future Considerations)

*   **增加更多练习:** 设计一个可扩展的练习加载机制，方便未来添加更多故障场景（如子网掩码错误、DHCP 故障等）。
*   **用户进度保存:** (V2) 引入用户账户系统，允许学生保存和恢复他们的答题进度。
*   **教师模式:** (V2) 允许教师创建自定义的故障场景并分配给学生。

